{
  "frontmatter": {
    "slug": "use-umami-api-on-nuxt",
    "title": "åœ¨åšå®¢ä¸­æ·»åŠ  Umami è®¿é—®ç»Ÿè®¡æ•°æ®",
    "date": "2025-08-17",
    "description": "ä½¿ç”¨ Umami API åœ¨ Nuxt åšå®¢ä¸­å±•ç¤ºè®¿é—®ç»Ÿè®¡æ•°æ®ã€‚",
    "tags": [
      "å‰ç«¯",
      "å®ç”¨æ•™ç¨‹"
    ]
  },
  "content": "\r\næœ€è¿‘ï¼Œæˆ‘åœ¨ä½¿ç”¨ **Nuxt** é‡æ„æˆ‘çš„åšå®¢ã€‚åœ¨ [å…³äº](/about) é¡µé¢ä¸Šï¼Œæˆ‘å‚è€ƒäº† [å®‰çŸ¥é±¼](https://blog.anheyu.com/about/) çš„å¸ƒå±€ã€‚å…¶ä¸­æœ‰ä¸€ä¸ªè®¿é—®æ•°æ®ç»Ÿè®¡å¡ç‰‡ï¼ŒåŸæœ¬ä½¿ç”¨çš„æ˜¯ 51LAã€‚èµ·åˆæˆ‘ä¹Ÿå°è¯•è¿‡åœ¨ Nuxt ä¸­æ·»åŠ å®ƒï¼Œä½†å‘ç°å®˜æ–¹æŒ‚ä»¶åœ¨ Nuxt ä¸­ä¸å¥½ç›´æ¥ä½¿ç”¨ã€‚\r\n\r\n![å®‰çŸ¥é±¼-è®¿é—®ç»Ÿè®¡](https://cdn.zhengweixin.top/blog/posts/612e9ddb40fe4c3b8f02910c93817ee9.png)\r\n\r\nå°è¯•æ— æœåï¼Œæˆ‘æƒ³åˆ°äº†è‡ªå·±ä¸¤å¹´å‰æ­å»ºçš„ [Umami](https://umami.is/) ç»Ÿè®¡æœåŠ¡ã€‚\r\n\r\n## Umami æ­å»º\r\n\r\næˆ‘ä½¿ç”¨çš„æ˜¯ Vercel éƒ¨ç½²ï¼Œæ­å»ºæ­¥éª¤å¦‚ä¸‹ï¼ˆä½ ä¹Ÿå¯ä»¥é€‰æ‹©å…¶ä»–æœåŠ¡å•†ï¼‰ï¼š\r\n\r\n1. Fork å®˜æ–¹ GitHub ä»“åº“ [umami-software/umami](https://github.com/umami-software/umami)ã€‚\r\n\r\n2. åœ¨ Vercel ä¸­åˆ›å»ºæ•°æ®åº“ï¼š\r\n   - æ‰“å¼€ **Storage** é€‰é¡¹å¡ï¼Œåˆ›å»º PostgreSQL æ•°æ®åº“ã€‚\r\n   \r\n   ![vercel-storage](https://cdn.zhengweixin.top/blog/posts/34df58bdbb98404cb8b82dbc55ac356d.png)\r\n\r\n3. æ–°å»ºé¡¹ç›®ï¼Œé€‰æ‹©åˆš fork çš„ä»“åº“ã€‚\r\n   - æ·»åŠ ç¯å¢ƒå˜é‡ `DATABASE_URL`ï¼Œå€¼ä¸ºåˆšåˆ›å»ºçš„æ•°æ®åº“åœ°å€ã€‚ä¾‹å¦‚ï¼š\r\n     ```\r\n     postgresql://username:password@localhost:5432/mydb\r\n     ```\r\n     \r\n\r\nåˆ°è¿™é‡Œï¼ŒUmami å°±éƒ¨ç½²å®Œæˆäº†ã€‚æœ¬æ–‡é‡ç‚¹ä¸åœ¨éƒ¨ç½²ç»†èŠ‚ï¼Œæ‰€ä»¥è¿™é‡Œåªç®€å•è¯´æ˜ ğŸ˜ºã€‚\r\n\r\n## API ç®€ä»‹\r\n\r\nUmami æä¾›äº†ä¸°å¯Œçš„ APIï¼Œå¯å‚è€ƒ [å®˜æ–¹æ–‡æ¡£](https://umami.is/docs/api/authentication)ã€‚\r\n\r\n| API                                   | åŠŸèƒ½             |\r\n| ------------------------------------ | ---------------- |\r\n| POST /api/auth/login                  | è·å–ç”¨æˆ·ä¿¡æ¯     |\r\n| GET /api/websites/:websiteId          | è·å–ç½‘ç«™ä¿¡æ¯     |\r\n| GET /api/websites/:websiteId/stats    | è·å–è®¿é—®é‡       |\r\n| GET /api/websites/:websiteId/metrics  | è·å–æ–‡ç« é˜…è¯»é‡   |\r\n\r\n## è·å– Token\r\n\r\nä½¿ç”¨ API ä¹‹å‰ï¼Œéœ€è¦å…ˆè·å–è´¦å· **Token**ã€‚  \r\né€šè¿‡ `POST /api/auth/login` å‘é€è´¦å·å¯†ç å³å¯è·å–ï¼š\r\n\r\n```json\r\n{\r\n  \"username\": \"your-username\",\r\n  \"password\": \"your-password\"\r\n}\r\n```\r\n\r\nè¿”å›ç¤ºä¾‹ï¼š\r\n\r\n\r\n```json\r\n{\r\n  \"token\": \"Mcfd5PaVC4cMDSJw51j...dvM+gvwvuDw==\",\r\n  \"user\": {\r\n    \"id\": \"7d7cf1f3-4d81-4a6b-8257-57a2ee4629a2\",\r\n    \"username\": \"visitor\",\r\n    \"createdAt\": \"2025-08-17T03:19:58.646Z\"\r\n  }\r\n}\r\n```\r\n\r\nè¿™é‡Œåˆ†äº«ä¸€ä¸ªç®€å•çš„ Python è„šæœ¬ç¤ºä¾‹ï¼Œç”¨äºè·å– Tokenï¼š\r\n\r\n```python\r\nimport requests\r\n\r\n# Umami API åœ°å€\r\nUMAMI_URL = 'https://statistics.zhengweixin.top'\r\n\r\n# è´¦å·å¯†ç \r\nUSERNAME = '******'\r\nPASSWORD = '******'\r\n\r\ndef get_token():\r\n    login_url = f\"{UMAMI_URL}/api/auth/login\"\r\n    payload = {\r\n        \"username\": USERNAME,\r\n        \"password\": PASSWORD\r\n    }\r\n    headers = {\r\n        \"Content-Type\": \"application/json\"\r\n    }\r\n\r\n    response = requests.post(login_url, json=payload, headers=headers)\r\n    \r\n    if response.status_code == 200:\r\n        data = response.json()\r\n        token = data.get(\"token\")\r\n        user_info = data.get(\"user\")\r\n        print(\"Token:\", token)\r\n        print(\"User info:\", user_info)\r\n        return token\r\n    else:\r\n        print(f\"Failed to get token: {response.status_code} {response.text}\")\r\n        return None\r\n\r\nif __name__ == \"__main__\":\r\n    get_token()\r\n\r\n```\r\n\r\n## åœ¨ Nuxt é¡µé¢ä¸­ä½¿ç”¨ API\r\n\r\nè·å–åˆ° Token åï¼Œåœ¨éœ€è¦ä½¿ç”¨çš„é¡µé¢ä¸­æ·»åŠ å¦‚ä¸‹ä»£ç ï¼š\r\n\r\n```javascript\r\n// é…ç½®\r\nconst UMAMI_URL = 'https://statistics.zhengweixin.top'; //Umamié“¾æ¥\r\nconst WEBSITE_ID = '7441ce23-3587-41b6-8919-e42932fc65d7'; //ç«™ç‚¹ID\r\nconst TOKEN = 'ä½ çš„Token';\r\nconst CREATED_AT = '2025-08-15T16:00:00.000Z'; //ç½‘ç«™åˆ›ç«‹æ—¶é—´\r\n\r\nconst statsToday = ref(null);\r\nconst statsYesterday = ref(null);\r\nconst statsTotal = ref(null);\r\nconst error = ref(null);\r\n\r\nfunction getDayTimestamps(date = new Date()) {\r\n  const start = new Date(date);\r\n  start.setHours(0, 0, 0, 0);\r\n  const end = new Date(start);\r\n  end.setHours(23, 59, 59, 999);\r\n  return { start: start.getTime(), end: end.getTime() };\r\n}\r\n\r\nonMounted(async () => {\r\n  try {\r\n    const createdAtTs = new Date(CREATED_AT).getTime();\r\n    const now = Date.now();\r\n\r\n    // ä»Šæ—¥\r\n    const { start: startToday, end: endToday } = getDayTimestamps();\r\n    statsToday.value = await fetch(`${UMAMI_URL}/api/websites/${WEBSITE_ID}/stats?startAt=${startToday}&endAt=${endToday}`, {\r\n      headers: { Authorization: `Bearer ${TOKEN}` }\r\n    }).then(res => res.json());\r\n\r\n    // æ˜¨æ—¥\r\n    const yesterday = new Date();\r\n    yesterday.setDate(yesterday.getDate() - 1);\r\n    const { start: startYesterday, end: endYesterday } = getDayTimestamps(yesterday);\r\n    statsYesterday.value = await fetch(`${UMAMI_URL}/api/websites/${WEBSITE_ID}/stats?startAt=${startYesterday}&endAt=${endYesterday}`, {\r\n      headers: { Authorization: `Bearer ${TOKEN}` }\r\n    }).then(res => res.json());\r\n\r\n    // æ€»é‡\r\n    statsTotal.value = await fetch(`${UMAMI_URL}/api/websites/${WEBSITE_ID}/stats?startAt=${createdAtTs}&endAt=${now}`, {\r\n      headers: { Authorization: `Bearer ${TOKEN}` }\r\n    }).then(res => res.json());\r\n\r\n  } catch (e) {\r\n    error.value = e.message;\r\n  }\r\n});\r\n```\r\n\r\né¡µé¢ä¸­å¯ç”¨å˜é‡ï¼š\r\n\r\n|                                |              |\r\n| ------------------------------ | ------------ |\r\n| statsToday.visitors.value      | ä»Šæ—¥è®¿é—®äººæ•° |\r\n| statsToday.pageviews.value     | ä»Šæ—¥è®¿é—®é‡   |\r\n| statsYesterday.visitors.value  | æ˜¨æ—¥è®¿é—®äººæ•° |\r\n| statsYesterday.pageviews.value | æ˜¨æ—¥è®¿é—®é‡   |\r\n| statsTotal.pageviews.value     | æœ¬æœˆè®¿é—®æ€»é‡ |\r\n| statsTotal.pageviews.value     | æ€»è®¿é—®é‡     |\r\n\r\n"
}